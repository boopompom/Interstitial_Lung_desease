#Sylvain Kritter 2 mai 2016import osimport numpy as npimport scipy.miscfrom matplotlib import pyplot as plt#custome file pyfrom fillshape import *from generatetabc import *#customisation part# define the dicom image format bmp or jpgtypei='bmp'#dicom file size in pixelsdimtabx = 512dimtaby = 512#patch size in pixelsdimpavx = 32dimpavy = 32#threshold for patchthr=0.8#directory name with patient databases, should be in current directorynamedirtop = 'ILD_DB_txtROIs'###########end customisation part############################################################################listlabel=[]cwd=os.getcwd()#cwd = final#print (cwd)listcwd=os.listdir(cwd)namedirtopc =cwd+'/'+namedirtop#namedirtopc= final/ILD_DB_txtROIs#print(namedirtopc)listdirc= (os.listdir(namedirtopc))#print(listcwd)jpegpath=cwd+'/jpeg'#jpegpath = final/jpegif 'patch' not in listcwd:    os.mkdir(cwd+'/patch')patchpath = cwd+'/patch'#patchpath = final/jpegif 'jpeg' not in listcwd:    os.mkdir(jpegpath)#print(listdirc)for f in listdirc:    #f = 35    posp=f.find('.',0)    posu=f.find('_',0)    namedirtopcf=namedirtopc+'/'+f    #namedirtopcf = final/ILD_DB_txtROIs/35    if posp==-1 and posu==-1:        contenudir = os.listdir(namedirtopcf)#        print(contenudir)        if  'patchfile' not in contenudir:            os.mkdir(namedirtopcf+'/patchfile')        for f1 in contenudir:            posp1=f1.find('.txt',0)            posc1=f1.find('CT',0)#            print(posp1,posc1)            if posp1>0 and posc1==0:                fileList =f1                ##f1 = CT-INSPIRIUM-1186.txt                pathf1=namedirtopcf+'/'+fileList                #pathf1=final/ILD_DB_txtROIs/35/CT-INSPIRIUM-1186.txt                print('work on:',f)                label,loca,coefi =fileext(pathf1,namedirtopcf,cwd)                if label not in listlabel:                    listlabel.append(label+'_'+loca)                    print('list label',listlabel)                for l in listlabel   :                        contenudir = os.listdir(cwd+'/patch')#                        print(contenudir)                        if  l not in contenudir:                            os.mkdir(cwd+'/patch/'+l)        listslice= os.listdir(namedirtopcf+'/patchfile') #        print(listslice)        for l in listslice:            if l.find('s',0)==0:                pathl=namedirtopcf+'/patchfile/'+l                #pathl=final/ILD_DB_txtROIs/35/slice2micronodulesdiffuse.txt                tabcff = np.loadtxt(pathl,dtype='f')                tabccfi=tabcff/coefi                tabc=tabccfi.astype(int)                print('generate tables from:',l,'in:', f)                tabz= reptfull(tabc,dimtabx,dimtaby)                                il=l.find('.',0)                iln=l[0:il]                #coefi=0.79296875                #iln=slice2micronodulesdiffuse                #label=micronodules                #loca=diffuse#                print(tabc)                print('creates patches from:',iln, 'in:', f)                tabz1=pavs (tabz,dimtabx,dimtaby,dimpavx,dimpavy,namedirtopcf,\                jpegpath, patchpath,thr,iln,f,label,loca,typei)                print('completed')   